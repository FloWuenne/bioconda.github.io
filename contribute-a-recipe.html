
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Contributing a recipe &#8212; Bioconda  documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/custom.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Troubleshooting failed recipes" href="troubleshooting.html" />
    <link rel="prev" title="One-time setup" href="contrib-setup.html" />
<link href="https://fonts.googleapis.com/css?family=Lato|Raleway" rel="stylesheet"> 
<link rel="stylesheet" type="text/css" href="_static/font-awesome-4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" type="text/css" href="_static/style.css">
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/dt/jqc-1.12.3/dt-1.10.12/datatables.min.css"/>
<link href="https://fonts.googleapis.com/css?family=Inconsolata" rel="stylesheet">

<link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
<link rel="icon" type="image/png" sizes="192x192"  href="/android-icon-192x192.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
<meta name="theme-color" content="#ffffff">
<script type="text/javascript" src="https://cdn.datatables.net/v/dt/jqc-1.12.3/dt-1.10.12/datatables.min.js"></script>

<script type="text/javascript" class="init">
$(document).ready(function() {
    $('#recipestable').DataTable( {
        "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]]
    } );
} );
</script>

  </head>
  <body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="contributing-a-recipe">
<h1>Contributing a recipe<a class="headerlink" href="#contributing-a-recipe" title="Permalink to this headline">¶</a></h1>
<p>The following steps are done for each recipe or batch of recipes you’d like to
contribute.</p>
<div class="section" id="update-repo">
<h2>1. Update repo<a class="headerlink" href="#update-repo" title="Permalink to this headline">¶</a></h2>
<p>If you’re using a fork (set up as <a class="reference internal" href="contrib-setup.html#github-setup"><span class="std std-ref">above</span></a>):</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>git checkout master
git pull upstream master
</pre></div>
</div>
<p>If you’re using a clone:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>git checkout master
git pull origin master
</pre></div>
</div>
</div>
<div class="section" id="build-an-isolated-conda-installation-with-dependencies">
<h2>2. Build an isolated conda installation with dependencies<a class="headerlink" href="#build-an-isolated-conda-installation-with-dependencies" title="Permalink to this headline">¶</a></h2>
<p>In the top level of the bioconda-recipes repo, run:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>./simulate-travis.py --bootstrap /tmp/miniconda --overwrite
</pre></div>
</div>
<p>This will:</p>
<ul class="simple">
<li>create a conda installation in <code class="docutils literal"><span class="pre">/tmp/miniconda</span></code> that is separate from any
Python or conda you might already have on your system. No root privileges are
needed.</li>
<li>set up the proper channel order</li>
<li>install <code class="docutils literal"><span class="pre">bioconda-utils</span></code> and its dependencies into that installation</li>
<li>write a config file at <code class="docutils literal"><span class="pre">~/.config/bioconda/config.yml</span></code> to persistently
store the location of this new installation so that subsequent calls to
<code class="docutils literal"><span class="pre">simulate-travis.py</span></code> will use it with no further configuration.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>If you plan on running <cite>bioconda-utils</cite> outside the context of
<cite>simulate-travis.py</cite> – for example to build recipe skeletons, inspect the
DAG of recipes, or other maintenance and development work – you need to
call it using its full path. If you used <code class="docutils literal"><span class="pre">/tmp/miniconda</span></code> as the
bootstrap path in the command above, then use
<code class="docutils literal"><span class="pre">/tmp/miniconda/bin/bioconda-utils</span></code>.</p>
<p class="last">This is by design: we want to keep all bioconda-related tools, which may
have specific dependencies that must exist in the root environment,
isolated from any environments you may have on your system.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>The bootstrap operation runs relatively quickly, so you might consider
running it every time you build and test a new recipe to ensure tests on
travis-ci go as smoothly as possible.</p>
<p class="last">If you are running into particularly difficult-to-troubleshoot issues, try
removing the installation directory completely and then re-installing using
the <code class="docutils literal"><span class="pre">--bootstrap</span></code> argument.</p>
</div>
</div>
<div class="section" id="write-a-recipe">
<h2>3. Write a recipe<a class="headerlink" href="#write-a-recipe" title="Permalink to this headline">¶</a></h2>
<p>Check out a new branch (here the branch is arbitrarily named “my-recipe”):</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>git checkout -b my-recipe
</pre></div>
</div>
<p>and write one or more recipes. The <a class="reference external" href="http://conda.pydata.org/docs/building/recipe.html">conda-build docs</a> are the authoritative
source for information on building a recipe.</p>
<p>Please familiarize yourself with the <a class="reference internal" href="guidelines.html#guidelines"><span class="std std-ref">Guidelines for bioconda recipes</span></a> for details on
bioconda-specific policies.</p>
</div>
<div class="section" id="test-locally">
<span id="id1"></span><h2>4. Test locally<a class="headerlink" href="#test-locally" title="Permalink to this headline">¶</a></h2>
<p>To test the recipe in a way more representative of the travis-ci environment,
use the <code class="docutils literal"><span class="pre">simulate-travis.py</span></code> script in the top-level directory of the repo.</p>
<p><code class="docutils literal"><span class="pre">simulate-travis.py</span></code> reads the config files in the repo and sets things up as
closely as possible to how the builds will be run on travis-ci. It should be
run from the top-level dir of the repo.  See <code class="docutils literal"><span class="pre">simulate-travis.py</span> <span class="pre">-h</span></code> for
details; below are some example uses.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Previously, it was mandatory to build any recipe <em>before</em> using
<cite>simulate-travis.py</cite> for the first time. Recent changes should have fixed
this, but if you see errors related to a directory not being found in the
docker container, try building any recipe locally with conda-build. If you used
using the <code class="docutils literal"><span class="pre">--bootstrap</span></code> method described above, make sure you call
conda-build from that path explicitly, e.g.:</p>
<div class="last highlight-default"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">miniconda</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">conda</span><span class="o">-</span><span class="n">build</span> <span class="n">recipes</span><span class="o">/</span><span class="n">snakemake</span>
</pre></div>
</div>
</div>
<div class="section" id="example-commands">
<h3>Example commands<a class="headerlink" href="#example-commands" title="Permalink to this headline">¶</a></h3>
<p>The following commands assume you have run <code class="docutils literal"><span class="pre">./simulate-travis.py</span> <span class="pre">--bootstrap</span>
<span class="pre">/tmp/miniconda</span></code>.</p>
<p>Recommended usage: build and test recipes with commits that have changed since
the master branch in a Docker container, and then run independent tests with
<code class="docutils literal"><span class="pre">mulled-build</span></code>.  This most closely replicates the work performed on
travis-ci:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">simulate</span><span class="o">-</span><span class="n">travis</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>Same as above, but also test recipes that have changes not yet committed to git:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">simulate</span><span class="o">-</span><span class="n">travis</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">git</span><span class="o">-</span><span class="nb">range</span> <span class="n">HEAD</span>
</pre></div>
</div>
<p>Same as above, but disable the use of Docker when building packages and disable
the stringent <code class="docutils literal"><span class="pre">mulled-build</span></code> tests. Therefore even if this command passes it
still might fail on travis-ci, but it is useful for cases where Docker is
unavailable:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">simulate</span><span class="o">-</span><span class="n">travis</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">git</span><span class="o">-</span><span class="nb">range</span> <span class="n">HEAD</span> <span class="o">--</span><span class="n">disable</span><span class="o">-</span><span class="n">docker</span>
</pre></div>
</div>
<p>By default, packages whose version and build number match an existing package
in the bioconda channel will not be built.</p>
<p>To specify exactly which packages you want to try building, use the
<cite>–packages</cite> argument. Note that the arguments to <cite>–packages</cite> can be globs and
are of package <em>names</em> rather than <em>paths</em> to recipe directories. For example,
to consider all R and Bioconductor packages:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">simulate</span><span class="o">-</span><span class="n">travis</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">packages</span> <span class="n">r</span><span class="o">-*</span> <span class="n">bioconductor</span><span class="o">-*</span>
</pre></div>
</div>
<p>However if those packages already exist in the bioconda channel, they will not
be built. To force a package:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">simulate</span><span class="o">-</span><span class="n">travis</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">packages</span> <span class="n">snakemake</span> <span class="o">--</span><span class="n">force</span>
</pre></div>
</div>
<p>To force <strong>all</strong> packages (warning, this will <em>rebuild all packages</em> and will
consume lots of resources:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># You probably don&#39;t want to run this.</span>
<span class="c1"># ./simulate-travis.py --force</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">See <a class="reference internal" href="troubleshooting.html#reading-logs"><span class="std std-ref">Reading bioconda-utils logs on Travis-CI</span></a> for tips on finding the information you need from
log files.</p>
</div>
</div>
</div>
<div class="section" id="push-changes-wait-for-tests-to-pass-submit-pull-request">
<h2>5. Push changes, wait for tests to pass, submit pull request<a class="headerlink" href="#push-changes-wait-for-tests-to-pass-submit-pull-request" title="Permalink to this headline">¶</a></h2>
<p>Push your changes to your fork or to the main repo (if using a clone) to GitHub:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">push</span> <span class="n">origin</span> <span class="n">my</span><span class="o">-</span><span class="n">recipe</span>
</pre></div>
</div>
<p>If using a fork, watch the Travis-CI logs by going to travis-ci.org and finding
your fork of bioconda-recipes. Keep making changes on your fork and pushing
them until the travis-ci builds pass. When they pass, create a <a class="reference external" href="https://help.github.com/articles/about-pull-requests/">pull request</a> on the main bioconda
repo for your changes.</p>
<p>If using a clone, you will have to open a pull request to get the tests to run.
The travis-ci tests intentionally short-circuit when not on a pull request to
save on resources.</p>
<p>Make and push changes as needed to get the tests to pass. If it’s your first
recipe or the recipe is doing something non-standard, please
ask <cite>&#64;bioconda/core</cite> for a review. If you are a member of the bioconda team,
feel free to merge your recipe once the tests pass.</p>
<p>At this point, Travis-CI will test your contribution in full.</p>
</div>
<div class="section" id="use-your-new-recipe">
<h2>6. Use your new recipe<a class="headerlink" href="#use-your-new-recipe" title="Permalink to this headline">¶</a></h2>
<p>When the PR is merged with the master branch, travis-ci will again do the
builds but at the end will upload the packages to anaconda.org. Once this
completes, and as long as the channels are set up as described in
<a class="reference internal" href="index.html#set-up-channels"><span class="std std-ref">2. Set up channels</span></a>, your new package is installable by anyone using:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">conda</span> <span class="n">install</span> <span class="n">my</span><span class="o">-</span><span class="n">package</span><span class="o">-</span><span class="n">name</span>
</pre></div>
</div>
<p>It is recommended that users set up channels as described in
<a class="reference internal" href="index.html#set-up-channels"><span class="std std-ref">2. Set up channels</span></a> to ensure that packages and dependencies are handled
correctly, and that they create an isolated environment when installing using
<code class="docutils literal"><span class="pre">conda</span> <span class="pre">create</span> <span class="pre">-n</span> <span class="pre">env-name-here</span></code>.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="index.html">
    <img class="logo" src="_static/logo/bioconda_monochrome_small.png" alt="Logo"/>
    
  </a>
</p>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="recipes.html">Available packages</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="contributing.html">Contributing</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="contrib-setup.html">One-time setup</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Contributing a recipe</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#update-repo">1. Update repo</a></li>
<li class="toctree-l3"><a class="reference internal" href="#build-an-isolated-conda-installation-with-dependencies">2. Build an isolated conda installation with dependencies</a></li>
<li class="toctree-l3"><a class="reference internal" href="#write-a-recipe">3. Write a recipe</a></li>
<li class="toctree-l3"><a class="reference internal" href="#test-locally">4. Test locally</a></li>
<li class="toctree-l3"><a class="reference internal" href="#push-changes-wait-for-tests-to-pass-submit-pull-request">5. Push changes, wait for tests to pass, submit pull request</a></li>
<li class="toctree-l3"><a class="reference internal" href="#use-your-new-recipe">6. Use your new recipe</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="troubleshooting.html">Troubleshooting failed recipes</a></li>
<li class="toctree-l2"><a class="reference internal" href="build-system.html">Build system</a></li>
<li class="toctree-l2"><a class="reference internal" href="guidelines.html">Guidelines for <code class="docutils literal"><span class="pre">bioconda</span></code> recipes</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="linting.html">Linting</a></li>
<li class="toctree-l1"><a class="reference internal" href="faqs.html">FAQs</a></li>
</ul>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2016, The Bioconda Team.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.6.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.9</a>
      
      |
      <a href="_sources/contribute-a-recipe.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>